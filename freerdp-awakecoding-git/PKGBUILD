# Maintainer: Julien Nicoulaud <julien.nicoulaud@gmail.com>
# Source: https://github.com/nicoulaj/archlinux-packages
# Contributor: Christian Hesse <mail@eworm.de>
# Contributor: Alexey Vasiliev <robbinton@gmail.com>

pkgname=freerdp-awakecoding-git
pkgdesc="Free RDP client  - awakecoding's fork"
pkgver=283.19d2bc3
pkgrel=1
depends=(openssl
         libxcursor
         libcups
         alsa-lib
         libxext
         libxdamage
         ffmpeg
         libxkbfile
         libxinerama
         libxv)
makedepends=(git
             krb5
             cmake
             damageproto)
arch=(i686 x86_64)
url="https://github.com/awakecoding/FreeRDP"
license=(GPL)
provides=(freerdp)
conflicts=(freerdp freerdp-git)

_gitroot="https://github.com/awakecoding/FreeRDP.git"
_gitname="freerdp"

pkgver() {
	cd "${srcdir}"
	echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

build() {
	cd "${srcdir}"
	msg "Connecting to GIT server...."

	if [ -d ${_gitname} ] ; then
		cd ${_gitname} && git pull origin
		msg "The local files are updated."
	else
		git clone ${_gitroot} ${_gitname}
	fi

	msg "GIT checkout done or server timeout"
	msg "Starting make..."

	cd "${srcdir}/${_gitname}"
	cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR=lib .
	make
}

package() {
	cd "${srcdir}/${_gitname}"
	cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR=lib .
	make DESTDIR="${pkgdir}/" install
}
